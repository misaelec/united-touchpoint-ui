<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>United BRC Demo</title>
    <link rel="icon" href="src/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="src/united-favicon.ico" type="image/x-icon" />
    <style>
      body {
        margin: 0;
        padding: 0;
        background-image: url('https://mma.prnewswire.com/media/1017594/United_Airlines_Star_Wars.jpg?p=publish'); /* Replace with your image path */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        height: 100vh;
        font-family: Arial, sans-serif;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      h1 {
        background-color: rgba(0, 0, 0, 0.5); /* Optional: adds contrast */
        padding: 20px;
        border-radius: 10px;
      }
      /* BagTimeline carousel */
      .bag-carousel {
        display: flex;
        overflow-x: auto;
        gap: 16px;
        padding: 16px;
        margin: 0 auto;
        max-width: calc(100% - 32px);
      }
      .bag-carousel-card {
        flex: 0 0 auto;
        background: #ffffff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
        min-width: 240px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .bag-carousel-card-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }
      .bag-carousel-card-details {
        font-size: 12px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import {
        create,
        React,
        html,
        TextButton,
        Icons,
        Carousel,
        CustomCard,
        CustomCardImageRow,
        CustomCardRow,
        BaseText
      } from "https://unpkg.com/@nlxai/touchpoint-ui@1.1.1/lib/index.js?module";
      const theme = {
        // Typography
        fontFamily: '"Barlow", sans-serif',

        // Primary colors (text)
        primary80: "#FDFFFF",

        // Secondary colors (backgrounds)
       
        // Accent and additional colors
        accent: "#1F14DC",
        accent20: "rgba(31, 20, 220, 0.2)",
        background: "#010208",

        // Status colors
        warningPrimary: "#FFA500",
        warningSecondary: "rgba(255, 165, 0, 0.1)",
        errorPrimary: "#FF0000",
        errorSecondary: "rgba(255, 0, 0, 0.1)",

        // Layout
        innerBorderRadius: "16px",
        outerBorderRadius: "24px",
      };

            const storageKey = "touchpoint-session";

            const saveSession = (conversationHandler, responses) => {
              const sessionData = {
                conversationId: conversationHandler.currentConversationId(),
                responses: responses,
              };
              sessionStorage.setItem(storageKey, JSON.stringify(sessionData));
            };

            const retrieveSession = () => {
              try {
                const data = JSON.parse(sessionStorage.getItem(storageKey) || "{}");
                if (data.responses && data.conversationId) {
                  return data;
                }
                return null;
              } catch (err) {
                return null;
              }
            };

            // Initialize touchpoint with persisted history
            const savedSession = retrieveSession();
						
						const BRCGenAIVideo = ({ data }) => {
		          const videoSrc = `https://www.youtube.com/embed/${data.src}`;
		          return html`
		            <iframe
		              width="264"
		              height="160"
		              src=${videoSrc}
		              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
		              allowFullScreen
		            ></iframe>`;
		        };

            const BagTimeline = ({ data, conversationHandler }) => {
  const [selectedId, setSelectedId] = React.useState(null);

  return html`
    <CustomCard key="bag-timeline-card" selected=${false}>
      ${data.history.map((evt) => {
        const location = evt.location || '';
        const hasTimestamp = Boolean(evt.timestamp);
        if (!hasTimestamp) return '';

        const d = new Date(evt.timestamp);
        const date = d.toLocaleDateString("es-ES", { day: "2-digit", month: "2-digit" });
        const time = d.toLocaleTimeString("es-ES", { hour: "2-digit", minute: "2-digit" });
        // assume evt.iconUrl holds your image source
        const iconUrl = evt.iconUrl || '/path/to/default-icon.png';

        return html`
          <${CustomCardRow}
            key=${evt.timestamp}
            left=${html`
              <div style="display:flex; align-items:center;">
                <img
                  src="/src/united-favicon.ico"
                  alt="event icon"
                  width="24"
                  height="24"
                  style="margin-right:8px; border-radius:4px;"
                />
                <${BaseText}>${date} ${time}<//>
              </div>
            `}
            right=${html`<${BaseText}>${location}<//>`}
            onClick=${() => {
              setSelectedId(evt.timestamp);
              conversationHandler.sendChoice(evt.timestamp);
            }}
            selected=${evt.timestamp === selectedId}
          />
        `;
      })}
    </CustomCard>
  `;

     const WebsiteAppButtons = ({ data }) => html`
    <CustomCard href=http://www.united.com/claimform newTab=${true}>
      <CustomCardRow  Icon=${Icons.ArrowForward} left=${html`<BaseText>Visit website</BaseText>`}
                     />
    </CustomCard>
    <CustomCard href=https://apps.apple.com/us/app/united-airlines/id449945214 newTab=${true}>
      <CustomCardRow  Icon=${Icons.ArrowForward} left=${html`<BaseText>View in app</BaseText>`}
       />
    </CustomCard>
  `;
	
            const touchpoint = await create({
              config: {
                applicationUrl: "https://bots.studio.nlx.ai/c/eQL89IjWj9c9OZ1NszEeb/6IzPmC88H7YWHlc1IT6w2",
                headers: { "nlx-api-key": "BnwW1Qlz3yL2wC19bofE58jr" },
                languageCode: "en-US",
                conversationId: savedSession?.conversationId,
                responses: savedSession?.responses
              },
              customModalities: {
               BRCGenAIVideo,
               BagTimeline,
               WebsiteAppButtons
              },
              // Brand customization
              colorMode: "dark", // "light" or "dark"
              theme: theme,
              windowSize: "half",
              brandIcon: "https://brandlogos.net/wp-content/uploads/2025/03/united_airlines_icon-logo_brandlogos.net_54inw.png", // Header logo
              launchIcon: "https://brandlogos.net/wp-content/uploads/2025/03/united_airlines_icon-logo_brandlogos.net_54inw.png", // Chat button icon
              chatMode: true,
              userMessageBubble: true,
              agentMessageBubble: true,
              chatMode: true
            });
            touchpoint.expanded = true;
                // Save session on every update
            touchpoint.conversationHandler.subscribe((responses) => {
              saveSession(touchpoint.conversationHandler, responses);
            });
    </script>
  </body>
</html>