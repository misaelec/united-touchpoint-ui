<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>United BRC Demo</title>
    <link rel="icon" href="src/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="src/united-favicon.ico" type="image/x-icon" />
    <style>
      body {
        margin: 0;
        padding: 0;
        background-image: url('https://mma.prnewswire.com/media/1017594/United_Airlines_Star_Wars.jpg?p=publish'); /* Replace with your image path */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        height: 100vh;
        font-family: Arial, sans-serif;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      h1 {
        background-color: rgba(0, 0, 0, 0.5); /* Optional: adds contrast */
        padding: 20px;
        border-radius: 10px;
      }
      /* BagTimeline card + rows */
      .bag-card {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 8px;
        padding: 16px;
        max-width: 400px;
        margin: 0 auto;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      .bag-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }
      .bag-row:last-child {
        border-bottom: none;
      }
      .bag-row-title {
        font-weight: 600;
        color: #ffffff;
      }
      .bag-row-details {
        font-size: 12px;
        color: #dddddd;
        text-align: right;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import { create, React, html, TextButton, Icons } from "https://unpkg.com/@nlxai/touchpoint-ui@1.1.1/lib/index.js?module";
            const theme = {
          // Typography
          fontFamily: '"Barlow", sans-serif',

          // Accent and additional colors
          accent: "#1F14DC",

          // Status colors
          warningPrimary: "#FFA500",
          warningSecondary: "rgba(255, 165, 0, 0.1)",
          errorPrimary: "#FF0000",
          errorSecondary: "rgba(255, 0, 0, 0.1)",

          // Layout
          innerBorderRadius: "4px",
          outerBorderRadius: "12px",
        };

            const storageKey = "touchpoint-session";

            const saveSession = (conversationHandler, responses) => {
              const sessionData = {
                conversationId: conversationHandler.currentConversationId(),
                responses: responses,
              };
              sessionStorage.setItem(storageKey, JSON.stringify(sessionData));
            };

            const retrieveSession = () => {
              try {
                const data = JSON.parse(sessionStorage.getItem(storageKey) || "{}");
                if (data.responses && data.conversationId) {
                  return data;
                }
                return null;
              } catch (err) {
                return null;
              }
            };

            // Initialize touchpoint with persisted history
            const savedSession = retrieveSession();
						
						const BRCGenAIVideo = ({ data }) => {
		          const videoSrc = `https://www.youtube.com/embed/${data.src}`;
		          return html`
		            <iframe
		              width="264"
		              height="160"
		              src=${videoSrc}
		              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
		              allowFullScreen
		            ></iframe>`;
		        };

           const BagTimeline = ({ data }) => {
             return html`
               <div class="bag-card">
                 ${data.history.map((evt) => {
                   const d = new Date(evt.timestamp);
                   const date = d.toLocaleDateString("es-ES", {
                     day: "2-digit",
                     month: "2-digit",
                     year: "numeric",
                   });
                   const time = d.toLocaleTimeString("es-ES", {
                     hour: "2-digit",
                     minute: "2-digit",
                   });
                   return html`
                     <div class="bag-row">
                       <div class="bag-row-title">${evt.event}</div>
                       <div class="bag-row-details">${date} ${time} â€” ${evt.location}</div>
                     </div>
                   `;
                 })}
               </div>
             `;
           };
	
            const touchpoint = await create({
              config: {
                applicationUrl: "https://bots.studio.nlx.ai/c/eQL89IjWj9c9OZ1NszEeb/6IzPmC88H7YWHlc1IT6w2",
                headers: { "nlx-api-key": "BnwW1Qlz3yL2wC19bofE58jr" },
                languageCode: "en-US",
                conversationId: savedSession?.conversationId,
                responses: savedSession?.responses
              },
              customModalities: {
               BRCGenAIVideo,
               BagTimeline
              },
              // Brand customization
              colorMode: "dark", // "light" or "dark"
              theme: theme,
              windowSize: "half",
              brandIcon: "https://brandlogos.net/wp-content/uploads/2025/03/united_airlines_icon-logo_brandlogos.net_54inw.png", // Header logo
              launchIcon: "https://brandlogos.net/wp-content/uploads/2025/03/united_airlines_icon-logo_brandlogos.net_54inw.png", // Chat button icon
              chatMode: true,
              userMessageBubble: true,
              agentMessageBubble: true,
              chatMode: true
            });
            touchpoint.expanded = true;
                // Save session on every update
            touchpoint.conversationHandler.subscribe((responses) => {
              saveSession(touchpoint.conversationHandler, responses);
            });
    </script>
  </body>
</html>